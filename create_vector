#  affinity vector is created and multiplied with gene expression values from receptors_contracted file
#  input param: target_dir
#  output: affinity vector in $target_dir
#  modification date: 21/08/2023

target_dir=$1
WORKDIR=$2

complexes=`wc -l < $WORKDIR/receptors_contracted`

> $target_dir/vec

for (( N=1; N<$((complexes+1)); N++ ))                 #create Rosetta vector
do
    printf -v comp_index "%03d" $N
    FBE=`cat ${target_dir}/log_${comp_index}.txt`
    echo $FBE >> $target_dir/vec
done
    
index=1
> $target_dir/vec.tmp
while read -r line
do
    genex=`echo $line | awk '{print $6}'`
    if  [ -z "$genex" ]                                    #set genex to 1 if unset or empty
    then
        genex=1
    fi
    affinity=`head -"$index" ${target_dir}/vec | tail -1`
    product=`echo $genex $affinity | awk '{print $1 * $2}'`
    echo $product >> ${target_dir}/vec.tmp
    let "index++"
done < $WORKDIR/receptors_contracted

mv $target_dir/vec.tmp ${target_dir}/vec
