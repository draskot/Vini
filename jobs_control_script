
# jobs_control_script
# input parameters: job_status max_jobs

job_status=$1 ; max_jobs=$2

$job_status | grep $USER > $WORKDIR/temp_buf #control the max number of concurrent jobs allowed
JOBS=`wc -l $WORKDIR/temp_buf | awk '{print $1}'`


while [ $JOBS -gt $max_jobs  ]
do
    echo "treshold of concurrent jobs exceeded, waiting before new job submission"
    $job_status | grep $USER > $WORKDIR/temp_buf 
    JOBS=`wc -l $WORKDIR/temp_buf | awk '{print $1}'`
    sleep 1
done
rm $WORKDIR/temp_buf
