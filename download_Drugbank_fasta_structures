NULL=0
ONES=1

echo -n "checking if fasta files are in place, please wait..."
lineno=1
while read -r line
do
    type=`echo $line | awk -F','   '{print $2}'`
    if [ $type == P ]
    then
        drug=`echo $line | awk -F','   '{print $1}'`
        if  [ ! -e $vini_dir/ligands/fasta_files/"${drug}".fasta ] 
        then
            grep "$drug" drug?links.csv > $WORKDIR/tmp
            inlines=`wc -l < $WORKDIR/tmp`  #there may be several lines with a same drug name
            if  [ $inlines -gt $NULL ]
            then   
                inline=`head -1 $WORKDIR/tmp`
                DBID=`echo $inline | tr "," " " | awk '{print $1}'`
                echo -n "Downloading" $drug "fasta file from Drugbank..."
                wget -O $vini_dir/ligands/fasta_files/"${drug}".fasta -q https://go.drugbank.com/drugs/${DBID}/polypeptide_sequences.fasta
                echo "done."
            else
                echo "drug" $drug "not found in Drugbank and will not be analysed." 
                awk -v "lineno=$lineno"  'NR==lineno { $0 = "#" $0 }; 1' $vini_dir/ligands/ligands_list > tmp
                mv tmp $vini_dir/ligands/ligands_list
            fi
        fi
        let "lineno++"
    fi
done < $vini_dir/ligands/ligands_list
echo "done."
rm -f tmp.csv tmp search
