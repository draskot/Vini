NULL=0   #checking if MD_prep and MD_run job finished or an error occured
error=0 ; rm -f tmp

while true
do
   sleep 1
   if  [ -e md_0_1.log ] #exit loop if MD_run job finished
   then
       grep Finished md_0_1.log > tmp
       if [ -s tmp ]
       then
           error=0 ; break
       fi
    fi

    grep Error MD_run.out > tmp #exit loop if MD_run job failed
    error=`wc -l < tmp`
    if  [ -s tmp ]
    then
        error=1 ; break
    fi

    grep Error MD_prep.out > tmp #exit loop if MD_prep job failed
    error=`wc -l < tmp`
    if  [ -s tmp ]
    then
        error=1 ; break
    fi

done

if [ $error -eq $NULL ]
then
    echo 1 > in.txt ; echo 13 >> in.txt ; echo q >> in.txt
    gmx make_ndx -backup -f em.gro -o md_0_1.ndx < in.txt
else
    touch ndx.error
fi
