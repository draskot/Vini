> $WORKDIR/failed_drug_predicted_structures
> $WORKDIR/failed_gene_predicted_structures

while read -r line
do
    type=`echo $line | awk -F','    '{print $2}'`
    if  [ $type == P ]
    then
        drug=`echo $line | awk -F',' '{print $1}'`
        subtype=`echo "$drug" | grep -oP 'mab.*?\b' | wc -l`
        if [ $subtype == 1 ] 
        then                                                               #drug is mAb and Rosetta Antibody was used
            if [ -e $WORKDIR/${drug}/H3_modeling/H3_modeling_scores.fasc ] #check if prediction succeeded
            then                                     
                sort -k3 -n -r $WORKDIR/${drug}/H3_modeling/H3_modeling_scores.fasc > tmp #select model with the lowest score
                line=`head -3 tmp | tail -1`
                model=`echo $line | awk  'NF>1{print $NF}'`
                cp $WORKDIR/${drug}/./H3_modeling/${model}.pdb $vini_dir/database/ligands/pdb_files/${antibody}.pdb
            else
                echo ${drug} >> $WORKDIR/failed_drug_predicted_structures
            fi
        else                                                              #Alphafold was used
            if  [ -e $WORKDIR/${drug}/ranked_0.pdb ]                      #check if prediction succeeded
            then                                                      
                cp $WORKDIR/${drug}/ranked_0.pdb ${vini_dir}/database/ligands/pdb_files/${protein}.pdb
            else                                                      #prediction failed
                echo ${drug} >> $WORKDIR/failed_drug_predicted_structures
            fi
        fi
    fi
done < $vini_dir/database/ligands/ligands_list

> tmp                     #update receptors_contracted file and copy predicted structures to repo
while read -r line
do
    KEGG_entry_id=`echo $line  | awk '{print $1}'`
    KEGG_gene_name=`echo $line | awk '{print $2}'`
    uniprot_id=`echo $line     | awk '{print $3}'`
    stat=`echo $line           | awk '{print $4}'`
    if  [ $stat != W ]
    then
        echo $line >> tmp
    else
        if  [ -e $WORKDIR/${uniprot_id}/ranked_0.pdb ]
        then                                                     #prediction succeeded
            stat=P
            cp $WORKDIR/${uniprot_id}/ranked_0.pdb $vini_dir/database/genes/pdb_files/${uniprot_id}.pdb
        else                                                     #prediction failed
            stat=F
            echo $uniprot_id >> $WORKDIR/failed_gene_predicted_structures
        fi
        echo ${KEGG_entry_id} ${KEGG_gene_name} ${uniprot_id} ${stat} >> tmp
    fi
done < $WORKDIR/receptors_contracted
mv tmp $WORKDIR/receptors_contracted
